<script>
	const goToSession = function (session = "home") {
		this.session = session;
	};
    
    const showError = function (error) {
        this.submitting = false
        const dialogData = {
            type: "error",
            active: true,
            content: error,
        }
        this.dialog = dialogData
    }
    
    const resetSignInForm = function () {
        const formData = {
            email: {
                value: "",
                valid: null,
                error: null,
            },
            password: {
                value: "",
                valid: null,
                error: null,
            },
            valid: null,
            title: "Sign in",
        }
        this.signInForm = formData
        return formData
    }
    
    const signIn = function(){
        this.submitting = true
        const email = this.signInForm.email.value
        const password = this.signInForm.password.value
        
        google.script.run
            .withSuccessHandler( (user) => {
                user = JSON.parse(user)
                this.user = user
                if (user){
                    this.resetSignInForm()
                    this.submitting = false
                }else{
                    this.showError("Wrong email or password.")
                }
            })
            .withFailureHandler( (error) => {
                this.showError(error.message)
            })
            .signIn({email, password})
    }
    
    
    const signOut = function(){
        this.submitting = true
        const user = JSON.stringify(this.user)
        google.script.run
            .withSuccessHandler( (user) => {
                user = JSON.parse(user)
                console.log(user)
                this.user = user
                this.submitting = false
            })
            .withFailureHandler( (error) => {
                this.showError(error.message)
            })
            .signOut(user)
    }
    
	const methods = {
		goToSession,
        showError,
        resetSignInForm,
        signIn,
        signOut,
	};
</script>
